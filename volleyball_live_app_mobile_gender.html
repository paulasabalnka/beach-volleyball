<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Beach Volleyball Live Scores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 10px;
      background: #f5f5f8;
      color: #222;
    }
    h1, h2, h3 {
      margin-bottom: 0.3rem;
    }
    h1 {
      font-size: 1.4rem;
    }
    h2 {
      margin-top: 1.1rem;
      font-size: 1.1rem;
    }
    h3 {
      margin-top: 0.8rem;
      font-size: 0.95rem;
    }
    .subtitle {
      color: #666;
      margin-bottom: 0.8rem;
      font-size: 0.8rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1.0rem;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 5px 4px;
      font-size: 0.75rem;
      text-align: center;
    }
    th {
      background: #f0f0f3;
      font-weight: 600;
    }
    tr:nth-child(even) {
      background: #fafafa;
    }
    input[type="number"] {
      width: 60px;
      padding: 6px 4px;
      text-align: center;
      font-size: 0.85rem;
      border-radius: 4px;
      border: 1px solid #bbb;
    }
    .court-barszczyk {
      background: #e3f0ff;
    }
    .court-makowiec {
      background: #e6ffea;
    }
    .winner-a {
      background: #d8ffd8 !important;
    }
    .winner-b {
      background: #ffe3e3 !important;
    }
    .draw-row {
      background: #fff9d6 !important;
    }
    .standings-table th {
      background: #e2e2ff;
    }
    .small {
      font-size: 0.75rem;
      color: #555;
    }
    .layout {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .card {
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      margin-bottom: 0.8rem;
    }
    @media (min-width: 900px) {
      .layout {
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>Beach Volleyball Live Scores</h1>
  <div class="subtitle">
    Works offline. Enter scores for each match. App auto-saves on this device.
  </div>

  <div class="layout">
    <div>
      <div class="card">
        <h2>Matches</h2>
        <p class="small">Tap the score boxes and type points for each team.</p>
        <table id="matches-table">
          <thead>
            <tr>
              <th>Rnd</th>
              <th>Court</th>
              <th>Team A</th>
              <th>Score A</th>
              <th>Team B</th>
              <th>Score B</th>
              <th>Winner</th>
              <th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div>
      <div class="card">
        <h2>Standings</h2>
        <p class="small">
          Sorted by: Wins ↓, Point diff ↓, Points for ↓.
          Split by gender below.
        </p>

        <h3>All players</h3>
        <table id="standings-all" class="standings-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>M</th>
              <th>W</th>
              <th>L</th>
              <th>For</th>
              <th>Agst</th>
              <th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <h3>Women</h3>
        <table id="standings-women" class="standings-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>M</th>
              <th>W</th>
              <th>L</th>
              <th>For</th>
              <th>Agst</th>
              <th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <h3>Men</h3>
        <table id="standings-men" class="standings-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>M</th>
              <th>W</th>
              <th>L</th>
              <th>For</th>
              <th>Agst</th>
              <th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const players = [
      "Chiara","Claudia","Pauli","Justyna",
      "Karol","Michał Nowo","Michał","Ziółek","Robert",
      "Marek","Marcin","Rafał","Paweł","Michał S"
    ];

    const gender = {
      "Chiara": "F",
      "Claudia": "F",
      "Pauli": "F",
      "Justyna": "F",
      "Karol": "M",
      "Michał Nowo": "M",
      "Michał": "M",
      "Ziółek": "M",
      "Robert": "M",
      "Marek": "M",
      "Marcin": "M",
      "Rafał": "M",
      "Paweł": "M",
      "Michał S": "M"
    };

    const rounds = [
      [1, "Barszczyk", ["Chiara","Ziółek"], ["Pauli","Paweł"]],
      [1, "Makowiec", ["Claudia","Karol"], ["Justyna","Rafał"]],

      [2, "Barszczyk", ["Claudia","Michał S"], ["Michał Nowo","Marek"]],
      [2, "Makowiec", ["Marcin","Michał"], ["Paweł","Robert"]],

      [3, "Barszczyk", ["Michał S","Karol"], ["Justyna","Michał Nowo"]],
      [3, "Makowiec", ["Marek","Robert"], ["Rafał","Ziółek"]],

      [4, "Barszczyk", ["Chiara","Marek"], ["Michał","Pauli"]],
      [4, "Makowiec", ["Karol","Robert"], ["Marcin","Paweł"]],

      [5, "Barszczyk", ["Chiara","Michał S"], ["Rafał","Michał Nowo"]],
      [5, "Makowiec", ["Claudia","Michał"], ["Marcin","Pauli"]],

      [6, "Barszczyk", ["Claudia","Michał"], ["Justyna","Paweł"]],
      [6, "Makowiec", ["Karol","Ziółek"], ["Rafał","Robert"]],

      [7, "Barszczyk", ["Chiara","Marcin"], ["Pauli","Michał S"]],
      [7, "Makowiec", ["Justyna","Michał Nowo"], ["Marek","Ziółek"]],

      [8, "Barszczyk", ["Chiara","Paweł"], ["Claudia","Karol"]],
      [8, "Makowiec", ["Justyna","Michał S"], ["Michał","Pauli"]],

      [9, "Barszczyk", ["Chiara","Marek"], ["Justyna","Marcin"]],
      [9, "Makowiec", ["Karol","Michał Nowo"], ["Robert","Ziółek"]],

      [10, "Barszczyk", ["Claudia","Robert"], ["Pauli","Rafał"]],
      [10, "Makowiec", ["Michał S","Michał"], ["Rafał","Marek"]],

      [11, "Barszczyk", ["Chiara","Marcin"], ["Claudia","Rafał"]],
      [11, "Makowiec", ["Michał Nowo","Paweł"], ["Robert","Ziółek"]],

      [12, "Barszczyk", ["Justyna","Marcin"], ["Pauli","Karol"]],
      [12, "Makowiec", ["Ziółek","Paweł"], ["Marek","Michał Nowo"]],

      [13, "Barszczyk", ["Claudia","Marcin"], ["Michał S","Michał"]],
      [13, "Makowiec", ["Karol","Rafał"], ["Marek","Ziółek"]],

      [14, "Barszczyk", ["Chiara","Robert"], ["Justyna","Michał"]],
      [14, "Makowiec", ["Michał S","Michał Nowo"], ["Pauli","Paweł"]],
    ];

    const matchesTableBody = document.querySelector("#matches-table tbody");
    const standingsAllBody = document.querySelector("#standings-all tbody");
    const standingsWomenBody = document.querySelector("#standings-women tbody");
    const standingsMenBody = document.querySelector("#standings-men tbody");

    const STORAGE_KEY = "vb_scores_michalS_v1";

    function renderMatches() {
      matchesTableBody.innerHTML = "";
      rounds.forEach((m, index) => {
        const [round, court, teamA, teamB] = m;

        const tr = document.createElement("tr");
        tr.dataset.matchIndex = index;
        tr.classList.add(court === "Barszczyk" ? "court-barszczyk" : "court-makowiec");

        const tdRound = document.createElement("td");
        tdRound.textContent = round;

        const tdCourt = document.createElement("td");
        tdCourt.textContent = court;

        const tdTeamA = document.createElement("td");
        tdTeamA.textContent = teamA.join(" + ");

        const tdScoreA = document.createElement("td");
        const inputA = document.createElement("input");
        inputA.type = "number";
        inputA.min = "0";
        inputA.inputMode = "numeric";
        inputA.dataset.role = "scoreA";
        tdScoreA.appendChild(inputA);

        const tdTeamB = document.createElement("td");
        tdTeamB.textContent = teamB.join(" + ");

        const tdScoreB = document.createElement("td");
        const inputB = document.createElement("input");
        inputB.type = "number";
        inputB.min = "0";
        inputB.inputMode = "numeric";
        inputB.dataset.role = "scoreB";
        tdScoreB.appendChild(inputB);

        const tdWinner = document.createElement("td");
        tdWinner.dataset.role = "winner";

        const tdDiff = document.createElement("td");
        tdDiff.dataset.role = "diff";

        tr.appendChild(tdRound);
        tr.appendChild(tdCourt);
        tr.appendChild(tdTeamA);
        tr.appendChild(tdScoreA);
        tr.appendChild(tdTeamB);
        tr.appendChild(tdScoreB);
        tr.appendChild(tdWinner);
        tr.appendChild(tdDiff);

        matchesTableBody.appendChild(tr);

        inputA.addEventListener("input", () => { updateAll(); saveScores(); });
        inputB.addEventListener("input", () => { updateAll(); saveScores(); });
      });

      loadScores();
    }

    function saveScores() {
      try {
        const scores = [...matchesTableBody.rows].map(row => {
          const a = row.querySelector('input[data-role="scoreA"]').value;
          const b = row.querySelector('input[data-role="scoreB"]').value;
          return { a, b };
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));
      } catch (e) {
        console.warn("Cannot save scores:", e);
      }
    }

    function loadScores() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const scores = JSON.parse(raw);
        [...matchesTableBody.rows].forEach((row, idx) => {
          const obj = scores[idx];
          if (!obj) return;
          const inputA = row.querySelector('input[data-role="scoreA"]');
          const inputB = row.querySelector('input[data-role="scoreB"]');
          if (obj.a !== undefined && obj.a !== null && obj.a !== "") inputA.value = obj.a;
          if (obj.b !== undefined && obj.b !== null && obj.b !== "") inputB.value = obj.b;
        });
      } catch (e) {
        console.warn("Cannot load scores:", e);
      }
      updateAll();
    }

    function updateAll() {
      const stats = {};
      players.forEach(p => {
        stats[p] = {
          player: p,
          gender: gender[p] || "M",
          matches: 0,
          wins: 0,
          losses: 0,
          ptsFor: 0,
          ptsAgainst: 0,
        };
      });

      [...matchesTableBody.rows].forEach(row => {
        row.classList.remove("winner-a","winner-b","draw-row");
      });

      [...matchesTableBody.rows].forEach((row, idx) => {
        const match = rounds[idx];
        const [round, court, teamA, teamB] = match;
        const inputA = row.querySelector('input[data-role="scoreA"]');
        const inputB = row.querySelector('input[data-role="scoreB"]');
        const winnerCell = row.querySelector('td[data-role="winner"]');
        const diffCell = row.querySelector('td[data-role="diff"]');

        const sA = inputA.value === "" ? null : parseInt(inputA.value, 10);
        const sB = inputB.value === "" ? null : parseInt(inputB.value, 10);

        winnerCell.textContent = "";
        diffCell.textContent = "";

        if (Number.isInteger(sA) && Number.isInteger(sB)) {
          const diff = sA - sB;
          diffCell.textContent = diff;

          teamA.forEach(p => {
            stats[p].matches += 1;
            stats[p].ptsFor += sA;
            stats[p].ptsAgainst += sB;
          });
          teamB.forEach(p => {
            stats[p].matches += 1;
            stats[p].ptsFor += sB;
            stats[p].ptsAgainst += sA;
          });

          if (sA > sB) {
            winnerCell.textContent = "A";
            row.classList.add("winner-a");
            teamA.forEach(p => stats[p].wins += 1);
            teamB.forEach(p => stats[p].losses += 1);
          } else if (sB > sA) {
            winnerCell.textContent = "B";
            row.classList.add("winner-b");
            teamB.forEach(p => stats[p].wins += 1);
            teamA.forEach(p => stats[p].losses += 1);
          } else {
            winnerCell.textContent = "=";
            row.classList.add("draw-row");
          }
        }
      });

      const statsArr = Object.values(stats).map(s => ({
        ...s,
        diff: s.ptsFor - s.ptsAgainst
      }));

      statsArr.sort((a,b) => {
        if (b.wins !== a.wins) return b.wins - a.wins;
        if (b.diff !== a.diff) return b.diff - a.diff;
        if (b.ptsFor !== a.ptsFor) return b.ptsFor - a.ptsFor;
        return a.player.localeCompare(b.player, 'pl');
      });

      function renderStandings(tbody, filterFn) {
        tbody.innerHTML = "";
        let rank = 1;
        statsArr.forEach(s => {
          if (filterFn && !filterFn(s)) return;
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${rank++}</td>
            <td>${s.player}</td>
            <td>${s.matches}</td>
            <td>${s.wins}</td>
            <td>${s.losses}</td>
            <td>${s.ptsFor}</td>
            <td>${s.ptsAgainst}</td>
            <td>${s.diff}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      renderStandings(standingsAllBody, null);
      renderStandings(standingsWomenBody, s => s.gender === "F");
      renderStandings(standingsMenBody, s => s.gender === "M");
    }

    renderMatches();
  </script>
</body>
</html>
