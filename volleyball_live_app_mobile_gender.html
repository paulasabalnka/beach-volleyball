
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ho-ho-ho Holiday Beachvolley Tournament</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 10px;
      background: #f5f5f8;
      color: #222;
    }
    h1, h2, h3 {
      margin-bottom: 0.3rem;
    }
    h1 {
      font-size: 1.4rem;
    }
    h2 {
      margin-top: 1.1rem;
      font-size: 1.1rem;
    }
    h3 {
      margin-top: 0.8rem;
      font-size: 0.95rem;
    }
    .subtitle {
      color:#666;
      margin-bottom:0.8rem;
      font-size:0.8rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1.0rem;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 5px 4px;
      font-size: 0.75rem;
      text-align: center;
    }
    th {
      background:#f0f0f3;
      font-weight:600;
    }
    tr:nth-child(even) { background:#fafafa; }
    input[type="number"] {
      width: 60px;
      padding: 6px 4px;
      text-align: center;
      font-size: 0.85rem;
      border-radius: 4px;
      border: 1px solid #bbb;
    }
    .court-barszczyk { background:#e3f0ff; }
    .court-makowiec { background:#e6ffea; }
    .winner-a { background:#d8ffd8 !important; }
    .winner-b { background:#ffe3e3 !important; }
    .draw-row { background:#fff9d6 !important; }
    .standings-table th { background:#e2e2ff; }
    .small { font-size:0.75rem; color:#555; }
    .layout { display:flex; flex-direction:column; gap:10px; }
    .card {
      background:#fff; padding:10px; border-radius:8px;
      box-shadow:0 1px 4px rgba(0,0,0,0.06); margin-bottom:0.8rem;
    }
    @media (min-width:900px) {
      .layout {
        display:grid;
        grid-template-columns:minmax(0,2fr) minmax(0,1.5fr);
        gap:16px;
      }
    }
  </style>
</head>
<body>
  <h1>Ho-ho-ho Holiday Beachvolley Tournament</h1>
  <div class="subtitle">
    Mixed & boys-only tournament. Coached by: Gee..Zdzisław
  </div>

  <div class="layout">
    <div>
      <div class="card">
        <h2>Matches</h2>
        <p class="small">Tap score boxes and type points for each team.</p>
        <table id="matches-table">
          <thead>
            <tr>
              <th>Rnd</th>
              <th>Court</th>
              <th>Team A</th>
              <th>Score A</th>
              <th>Team B</th>
              <th>Score B</th>
              <th>Winner</th>
              <th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div>
      <div class="card">
        <h2>Standings</h2>
        <p class="small">
          Sorted by: Wins ↓, Point diff ↓, Points for ↓. Split by gender.
        </p>

        <h3>All players</h3>
        <table id="standings-all" class="standings-table">
          <thead>
            <tr>
              <th>#</th><th>Player</th><th>M</th><th>W</th><th>L</th>
              <th>For</th><th>Agst</th><th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <h3>Women</h3>
        <table id="standings-women" class="standings-table">
          <thead>
            <tr>
              <th>#</th><th>Player</th><th>M</th><th>W</th><th>L</th>
              <th>For</th><th>Agst</th><th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <h3>Men</h3>
        <table id="standings-men" class="standings-table">
          <thead>
            <tr>
              <th>#</th><th>Player</th><th>M</th><th>W</th><th>L</th>
              <th>For</th><th>Agst</th><th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
const players = ['Chiara', 'Claudia', 'Pauli', 'Justyna', 'Karol', 'Michał Nowo', 'Michał', 'Ziółek', 'Robert', 'Marek', 'Marcin', 'Rafał', 'Paweł', 'Michał S'];
const gender = {
  "Chiara": "F",
  "Claudia": "F",
  "Pauli": "F",
  "Justyna": "F",
  "Karol": "M",
  "Michał Nowo": "M",
  "Michał": "M",
  "Ziółek": "M",
  "Robert": "M",
  "Marek": "M",
  "Marcin": "M",
  "Rafał": "M",
  "Paweł": "M",
  "Michał S": "M"
};
const rounds = [[1, 'Barszczyk', ['Chiara', 'Michał Nowo'], ['Claudia', 'Ziółek']], [1, 'Makowiec', ['Pauli', 'Robert'], ['Justyna', 'Michał']], [2, 'Barszczyk', ['Karol', 'Michał'], ['Robert', 'Marek']], [2, 'Makowiec', ['Marcin', 'Rafał'], ['Paweł', 'Michał S']], [3, 'Barszczyk', ['Chiara', 'Michał S'], ['Pauli', 'Karol']], [3, 'Makowiec', ['Claudia', 'Paweł'], ['Justyna', 'Marcin']], [4, 'Barszczyk', ['Karol', 'Michał Nowo'], ['Michał', 'Ziółek']], [4, 'Makowiec', ['Robert', 'Marek'], ['Marcin', 'Rafał']], [5, 'Barszczyk', ['Chiara', 'Rafał'], ['Claudia', 'Marek']], [5, 'Makowiec', ['Pauli', 'Michał Nowo'], ['Justyna', 'Karol']], [6, 'Barszczyk', ['Paweł', 'Michał S'], ['Karol', 'Michał Nowo']], [6, 'Makowiec', ['Michał', 'Robert'], ['Ziółek', 'Marek']], [7, 'Barszczyk', ['Chiara', 'Michał'], ['Claudia', 'Robert']], [7, 'Makowiec', ['Pauli', 'Rafał'], ['Justyna', 'Ziółek']], [8, 'Barszczyk', ['Marcin', 'Paweł'], ['Rafał', 'Michał S']], [8, 'Makowiec', ['Karol', 'Michał'], ['Michał Nowo', 'Ziółek']], [9, 'Barszczyk', ['Chiara', 'Marek'], ['Justyna', 'Michał S']], [9, 'Makowiec', ['Claudia', 'Marcin'], ['Pauli', 'Paweł']], [10, 'Barszczyk', ['Robert', 'Marcin'], ['Marek', 'Rafał']], [10, 'Makowiec', ['Paweł', 'Karol'], ['Michał S', 'Michał Nowo']], [11, 'Barszczyk', ['Chiara', 'Ziółek'], ['Pauli', 'Marek']], [11, 'Makowiec', ['Claudia', 'Michał Nowo'], ['Justyna', 'Robert']], [12, 'Barszczyk', ['Michał', 'Robert'], ['Ziółek', 'Marek']], [12, 'Makowiec', ['Marcin', 'Paweł'], ['Rafał', 'Michał S']], [13, 'Barszczyk', ['Chiara', 'Karol'], ['Justyna', 'Paweł']], [13, 'Makowiec', ['Claudia', 'Rafał'], ['Pauli', 'Michał S']], [14, 'Barszczyk', ['Chiara', 'Marcin'], ['Pauli', 'Ziółek']], [14, 'Makowiec', ['Claudia', 'Michał'], ['Justyna', 'Michał Nowo']]];
const matchesTableBody = document.querySelector("#matches-table tbody");
const standingsAllBody   = document.querySelector("#standings-all tbody");
const standingsWomenBody = document.querySelector("#standings-women tbody");
const standingsMenBody   = document.querySelector("#standings-men tbody");
const STORAGE_KEY = "vb_scores_new_ideal_v1";

function renderMatches() {
  matchesTableBody.innerHTML = "";
  rounds.forEach((m,index)=>{
    const [round,court,teamA,teamB] = m;
    const tr = document.createElement("tr");
    tr.classList.add(court === "Barszczyk" ? "court-barszczyk" : "court-makowiec");
    tr.innerHTML = `
      <td>${round}</td>
      <td>${court}</td>
      <td>${teamA.join(" + ")}</td>
      <td><input type="number" min="0" inputmode="numeric" data-role="scoreA" data-idx="${index}"></td>
      <td>${teamB.join(" + ")}</td>
      <td><input type="number" min="0" inputmode="numeric" data-role="scoreB" data-idx="${index}"></td>
      <td data-role="winner"></td>
      <td data-role="diff"></td>
    `;
    matchesTableBody.appendChild(tr);
  });

  document.querySelectorAll("input[data-role]").forEach(inp=>{
    inp.addEventListener("input", ()=>{ updateAll(); saveScores(); });
  });

  loadScores();
}

function saveScores() {
  try {
    const scores = [...matchesTableBody.rows].map(row=>{
      const a = row.querySelector('input[data-role="scoreA"]').value;
      const b = row.querySelector('input[data-role="scoreB"]').value;
      return {a,b};
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));
  } catch(e) {
    console.warn("Cannot save",e);
  }
}

function loadScores() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const scores = JSON.parse(raw);
    [...matchesTableBody.rows].forEach((row,idx)=>{
      const obj = scores[idx];
      if (!obj) return;
      const inputA = row.querySelector('input[data-role="scoreA"]');
      const inputB = row.querySelector('input[data-role="scoreB"]');
      if (obj.a !== undefined && obj.a !== "") inputA.value = obj.a;
      if (obj.b !== undefined && obj.b !== "") inputB.value = obj.b;
    });
  } catch(e) {
    console.warn("Cannot load",e);
  }
  updateAll();
}

function updateAll() {
  const stats = {};
  players.forEach(p=>{
    stats[p] = {
      player:p,
      gender:gender[p] || "M",
      matches:0,
      wins:0,
      losses:0,
      ptsFor:0,
      ptsAgainst:0
    };
  });

  [...matchesTableBody.rows].forEach(row=>{
    row.classList.remove("winner-a","winner-b","draw-row");
  });

  [...matchesTableBody.rows].forEach((row,idx)=>{
    const [round,court,teamA,teamB] = rounds[idx];
    const inputA = row.querySelector('input[data-role="scoreA"]');
    const inputB = row.querySelector('input[data-role="scoreB"]');
    const winnerCell = row.querySelector('td[data-role="winner"]');
    const diffCell = row.querySelector('td[data-role="diff"]');
    const sA = inputA.value === "" ? null : parseInt(inputA.value,10);
    const sB = inputB.value === "" ? null : parseInt(inputB.value,10);
    winnerCell.textContent = "";
    diffCell.textContent = "";

    if (Number.isInteger(sA) && Number.isInteger(sB)) {
      const diff = sA - sB;
      diffCell.textContent = diff;
      teamA.forEach(p=>{
        stats[p].matches += 1;
        stats[p].ptsFor  += sA;
        stats[p].ptsAgainst += sB;
      });
      teamB.forEach(p=>{
        stats[p].matches += 1;
        stats[p].ptsFor  += sB;
        stats[p].ptsAgainst += sA;
      });
      if (sA > sB) {
        winnerCell.textContent = "A";
        row.classList.add("winner-a");
        teamA.forEach(p=>stats[p].wins++);
        teamB.forEach(p=>stats[p].losses++);
      } else if (sB > sA) {
        winnerCell.textContent = "B";
        row.classList.add("winner-b");
        teamB.forEach(p=>stats[p].wins++);
        teamA.forEach(p=>stats[p].losses++);
      } else {
        winnerCell.textContent = "=";
        row.classList.add("draw-row");
      }
    }
  });

  const statsArr = Object.values(stats).map(s=>({
    ...s,
    diff: s.ptsFor - s.ptsAgainst
  }));

  statsArr.sort((a,b)=>{
    if (b.wins !== a.wins) return b.wins - a.wins;
    if (b.diff !== a.diff) return b.diff - a.diff;
    if (b.ptsFor !== a.ptsFor) return b.ptsFor - a.ptsFor;
    return a.player.localeCompare(b.player,'pl');
  });

  function renderStandings(tbody, filterFn) {
    tbody.innerHTML = "";
    let rank = 1;
    statsArr.forEach(s=>{
      if (filterFn && !filterFn(s)) return;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${rank++}</td>
        <td>${s.player}</td>
        <td>${s.matches}</td>
        <td>${s.wins}</td>
        <td>${s.losses}</td>
        <td>${s.ptsFor}</td>
        <td>${s.ptsAgainst}</td>
        <td>${s.diff}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  renderStandings(standingsAllBody, null);
  renderStandings(standingsWomenBody, s=>s.gender === "F");
  renderStandings(standingsMenBody,   s=>s.gender === "M");
}

renderMatches();
</script>
</body>
</html>
